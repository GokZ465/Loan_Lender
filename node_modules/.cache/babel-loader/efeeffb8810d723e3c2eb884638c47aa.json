{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useReducer, useEffect, useState } from \"react\";\nimport { fireStore, timestamp } from \"../fireBaeDateBae/config\";\nlet initialState = {\n  document: null,\n  isPending: false,\n  error: null,\n  success: null\n};\n\nconst firestoreReducer = (state, action) => {\n  switch (action.type) {\n    case 'IS_PENDING':\n      return {\n        isPending: true,\n        document: null,\n        success: false,\n        error: null\n      };\n\n    case 'ADDED_DOCUMENT':\n      return {\n        isPending: false,\n        document: action.payload,\n        success: true,\n        error: null\n      };\n\n    case 'DELETED_DOCUMENT':\n      return {\n        isPending: false,\n        document: null,\n        success: true,\n        error: null\n      };\n\n    case 'ERROR':\n      return {\n        isPending: false,\n        document: null,\n        success: false,\n        error: action.payload\n      };\n\n    default:\n      return state;\n  }\n};\n\nexport const useFirestore = collection => {\n  _s();\n\n  const [response, dispatch] = useReducer(firestoreReducer, initialState);\n  const [isCancelled, setIsCancelled] = useState(false); // collection ref\n\n  const ref = projectFirestore.collection(collection); // only dispatch is not cancelled\n\n  const dispatchIfNotCancelled = action => {\n    if (!isCancelled) {\n      dispatch(action);\n    }\n  }; // add a document\n\n\n  const addDocument = async doc => {\n    dispatch({\n      type: 'IS_PENDING'\n    });\n\n    try {\n      const createdAt = timestamp.fromDate(new Date());\n      const addedDocument = await ref.add({ ...doc,\n        createdAt\n      });\n      dispatchIfNotCancelled({\n        type: 'ADDED_DOCUMENT',\n        payload: addedDocument\n      });\n    } catch (err) {\n      dispatchIfNotCancelled({\n        type: 'ERROR',\n        payload: err.message\n      });\n    }\n  }; // delete a document\n\n\n  const deleteDocument = async id => {\n    dispatch({\n      type: 'IS_PENDING'\n    });\n\n    try {\n      await ref.doc(id).delete();\n      dispatchIfNotCancelled({\n        type: 'DELETED_DOCUMENT'\n      });\n    } catch (err) {\n      dispatchIfNotCancelled({\n        type: 'ERROR',\n        payload: 'could not delete'\n      });\n    }\n  };\n\n  useEffect(() => {\n    return () => setIsCancelled(true);\n  }, []);\n  return {\n    addDocument,\n    deleteDocument,\n    response\n  };\n};\n\n_s(useFirestore, \"9EVgiqay/R51d/Adc6OMNoHTwUQ=\");","map":{"version":3,"names":["useReducer","useEffect","useState","fireStore","timestamp","initialState","document","isPending","error","success","firestoreReducer","state","action","type","payload","useFirestore","collection","response","dispatch","isCancelled","setIsCancelled","ref","projectFirestore","dispatchIfNotCancelled","addDocument","doc","createdAt","fromDate","Date","addedDocument","add","err","message","deleteDocument","id","delete"],"sources":["E:/movie/loanLender/loanlender/src/hooks/useFirestore.js"],"sourcesContent":["import { useReducer, useEffect, useState } from \"react\";\r\nimport { fireStore, timestamp } from \"../fireBaeDateBae/config\";\r\n\r\nlet initialState = {\r\n    document: null,\r\n    isPending: false,\r\n    error: null,\r\n    success: null\r\n  }\r\n  \r\n  const firestoreReducer = (state, action) => {\r\n    switch (action.type) {\r\n      case 'IS_PENDING':\r\n        return { isPending: true, document: null, success: false, error: null }\r\n      case 'ADDED_DOCUMENT':\r\n        return { isPending: false, document: action.payload, success: true, error: null }\r\n      case 'DELETED_DOCUMENT':\r\n        return { isPending: false, document: null, success: true, error: null }\r\n      case 'ERROR':\r\n        return { isPending: false, document: null, success: false, error: action.payload }\r\n      default:\r\n        return state\r\n    }\r\n  }\r\n  \r\n  export const useFirestore = (collection) => {\r\n    const [response, dispatch] = useReducer(firestoreReducer, initialState)\r\n    const [isCancelled, setIsCancelled] = useState(false)\r\n  \r\n    // collection ref\r\n    const ref = projectFirestore.collection(collection)\r\n  \r\n    // only dispatch is not cancelled\r\n    const dispatchIfNotCancelled = (action) => {\r\n      if (!isCancelled) {\r\n        dispatch(action)\r\n      }\r\n    }\r\n  \r\n    // add a document\r\n    const addDocument = async (doc) => {\r\n      dispatch({ type: 'IS_PENDING' })\r\n  \r\n      try {\r\n        const createdAt = timestamp.fromDate(new Date())\r\n        const addedDocument = await ref.add({ ...doc, createdAt })\r\n        dispatchIfNotCancelled({ type: 'ADDED_DOCUMENT', payload: addedDocument })\r\n      }\r\n      catch (err) {\r\n        dispatchIfNotCancelled({ type: 'ERROR', payload: err.message })\r\n      }\r\n    }\r\n  \r\n    // delete a document\r\n    const deleteDocument = async (id) => {\r\n      dispatch({ type: 'IS_PENDING' })\r\n  \r\n      try {\r\n        await ref.doc(id).delete()\r\n        dispatchIfNotCancelled({ type: 'DELETED_DOCUMENT' })\r\n      }\r\n      catch (err) {\r\n        dispatchIfNotCancelled({ type: 'ERROR', payload: 'could not delete' })\r\n      }\r\n    }\r\n  \r\n    useEffect(() => {\r\n      return () => setIsCancelled(true)\r\n    }, [])\r\n  \r\n    return { addDocument, deleteDocument, response }\r\n  \r\n  }"],"mappings":"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"},"metadata":{},"sourceType":"module"}